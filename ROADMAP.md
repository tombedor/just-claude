# Just-Claude Implementation Roadmap

This document outlines the implementation phases for just-claude, with clear milestones and testable functionality at each step.

---

## Phase 0: Project Setup

**Goal**: Basic npm package structure with no functionality

### Deliverables
- [ ] `package.json` with metadata and dependencies
- [ ] Directory structure (`bin/`, `scripts/`, `templates/`, `lib/`, `test/`)
- [ ] TypeScript/JavaScript configuration (if using TS)
- [ ] Testing framework setup (Jest or Node.js test runner)
- [ ] Basic README.md with installation instructions

### Testable Functionality
```bash
# Package can be installed locally
npm install

# Package metadata is valid
npm pack
```

### Success Criteria
- `npm install` completes without errors
- Package structure follows npm best practices
- Test framework runs (even with no tests yet)

---

## Phase 1: Core JSON Parsing & Recipe Detection

**Goal**: Hook script can detect justfile and parse recipes using `just --dump`

### Deliverables
- [ ] `templates/detect-justfile.sh` hook script (basic version)
- [ ] JSON parsing logic in bash/node
- [ ] Recipe extraction (name, doc, parameters, private flag)
- [ ] Feature detection (`just` command availability)

### Testable Functionality
```bash
# Create test justfile
echo 'build:
    cargo build' > justfile

# Run hook script manually
bash templates/detect-justfile.sh

# Script exits 0 and outputs recipe info
```

### Test Cases
- ✅ Detect justfile exists
- ✅ Parse `just --dump --dump-format json` output
- ✅ Extract recipe names
- ✅ Extract recipe doc comments
- ✅ Identify recipe parameters (required vs optional)
- ✅ Filter out private recipes (starting with `_`)
- ✅ Handle missing `just` command gracefully
- ✅ Handle no justfile gracefully

### Success Criteria
- Hook script runs without errors
- Correctly parses 5+ different justfile configurations
- Unit tests pass for JSON parsing logic

---

## Phase 2: Basic Skill Generation

**Goal**: Generate SKILL.md files for simple recipes (no modules yet)

### Deliverables
- [ ] `lib/generator.js` - Skill generation logic
- [ ] SKILL.md template with YAML frontmatter
- [ ] Directory creation (`.claude/skills/just-<recipe>/`)
- [ ] Parameter documentation in skills
- [ ] Generated file marker (`<!-- Generated by just-claude -->`)

### Testable Functionality
```bash
# Create test justfile
echo '# Build the project
build:
    cargo build

# Run tests
test:
    cargo test' > justfile

# Run hook script
bash .claude/hooks/detect-justfile.sh

# Verify skills created
ls .claude/skills/
# Expected: just-build/  just-test/

cat .claude/skills/just-build/SKILL.md
# Expected: Properly formatted SKILL.md with frontmatter
```

### Test Cases
- ✅ Create skill directory for each recipe
- ✅ Generate SKILL.md with correct YAML frontmatter
- ✅ Include recipe doc comments in skill content
- ✅ Document parameters (required and optional)
- ✅ Include usage examples
- ✅ Add generated marker comment
- ✅ Handle recipes with no doc comments
- ✅ Handle recipes with no parameters
- ✅ Skill description auto-generated from doc or recipe name

### Success Criteria
- Skills generated for all public recipes
- SKILL.md format matches PRD specification
- Generated skills are readable and well-formatted
- Integration tests pass with real justfiles

---

## Phase 3: Module Support

**Goal**: Handle submodules and create nested skill directories

### Deliverables
- [ ] Module detection from JSON (`modules` object)
- [ ] Recursive recipe extraction from modules
- [ ] Nested directory creation (`.claude/skills/just-module/recipe/`)
- [ ] Namepath handling (`module::recipe`)

### Testable Functionality
```bash
# Create justfile with module
echo 'build:
    echo "main"

mod subdir' > justfile

mkdir -p subdir
echo 'deploy:
    echo "deploying"' > subdir/justfile

# Run hook script
bash .claude/hooks/detect-justfile.sh

# Verify nested skills created
ls .claude/skills/
# Expected: just-build/  just-subdir/

ls .claude/skills/just-subdir/
# Expected: deploy/

cat .claude/skills/just-subdir/deploy/SKILL.md
# Expected: Skill with "just subdir::deploy" usage
```

### Test Cases
- ✅ Detect modules in JSON output
- ✅ Extract recipes from nested modules
- ✅ Create nested skill directories
- ✅ Generate correct `just module::recipe` invocation
- ✅ Handle multiple levels of modules (if supported)
- ✅ Handle optional modules (`mod?`)

### Success Criteria
- Module recipes generate nested directories
- Skills correctly reference `just module::recipe`
- All module recipes are detected and generated
- Tests pass with complex module structures

---

## Phase 4: NPM Lifecycle Integration

**Goal**: Postinstall and preuninstall scripts automate setup/teardown

### Deliverables
- [ ] `scripts/postinstall.js` - Copy hook, configure settings.json
- [ ] `scripts/preuninstall.js` - Remove hook, cleanup skills
- [ ] Settings.json merging logic
- [ ] Backup/restore functionality
- [ ] Hook configuration with `$CLAUDE_PROJECT_DIR` path

### Testable Functionality
```bash
# Install package
npm install just-claude

# Verify files created
test -f .claude/hooks/detect-justfile.sh
test -f .claude/settings.json

# Verify settings.json contains hook
grep "detect-justfile.sh" .claude/settings.json

# Verify backup created if settings.json existed
test -f .claude/settings.json.backup  # (if pre-existing)

# Uninstall package
npm uninstall just-claude

# Verify cleanup
test ! -f .claude/hooks/detect-justfile.sh
test ! -d .claude/skills/just-*

# Verify settings.json restored if empty
# (or hook removed if other hooks exist)
```

### Test Cases
- ✅ Postinstall copies hook script from `templates/`
- ✅ Postinstall creates `.claude/` directory if missing
- ✅ Postinstall creates settings.json if missing
- ✅ Postinstall backs up existing settings.json
- ✅ Postinstall merges hook into existing settings.json
- ✅ Hook path uses `$CLAUDE_PROJECT_DIR`
- ✅ Preuninstall removes hook configuration
- ✅ Preuninstall removes hook script
- ✅ Preuninstall cleans up generated skills
- ✅ Preuninstall restores backup if hooks array empty
- ✅ Preuninstall preserves other hooks

### Success Criteria
- `npm install just-claude` fully configures the project
- `npm uninstall just-claude` completely removes all traces
- Settings.json merging handles all edge cases
- Tests verify installation/uninstallation workflows

---

## Phase 5: CLI Commands

**Goal**: Provide manual commands for init (sync), list, clean, status

### Deliverables
- [ ] `bin/cli.js` - CLI entry point
- [ ] `just-claude init` - Install hooks and regenerate skills
- [ ] `just-claude list` - Show generated skills
- [ ] `just-claude clean` - Remove all skills
- [ ] `just-claude status` - Show system status

### Testable Functionality
```bash
# Check status
just-claude status
# Expected: Shows justfile presence, recipe count, skill count

# List skills
just-claude list
# Expected: Lists all generated skills with recipe info

# Init/sync skills
just-claude init
# Expected: Installs hooks (if needed) and rebuilds all skills from current justfile

# Clean skills
just-claude clean
# Expected: Removes all just-* skill directories
ls .claude/skills/just-*  # Should be empty
```

### Test Cases
- ✅ `status` shows justfile presence
- ✅ `status` shows recipe count
- ✅ `status` shows generated skill count
- ✅ `status` shows `just` command availability
- ✅ `list` displays all generated skills
- ✅ `list` shows recipe info (name, params, doc)
- ✅ `init` removes old skills
- ✅ `init` creates new skills from justfile
- ✅ `clean` removes all just-* directories
- ✅ All commands have `--help` output

### Success Criteria
- All CLI commands work as documented
- Commands provide helpful output
- Error messages are clear and actionable
- Tests verify each command's behavior

---

## Phase 6: Edge Cases & Error Handling

**Goal**: Handle all edge cases gracefully with appropriate warnings/errors

### Deliverables
- [ ] No justfile handling (silent exit)
- [ ] Malformed justfile handling (log error, exit gracefully)
- [ ] `just` not installed handling (log warning, exit gracefully)
- [ ] No public recipes handling (info message)
- [ ] Skill name conflict detection
- [ ] Large justfile handling (100+ recipes)

### Testable Functionality
```bash
# Test: No justfile
rm justfile
bash .claude/hooks/detect-justfile.sh
# Expected: Exit 0, no errors, no skills created

# Test: Malformed justfile
echo 'invalid syntax!' > justfile
bash .claude/hooks/detect-justfile.sh
# Expected: Exit 0, error logged to stderr, no skills

# Test: Just not installed
PATH="" bash .claude/hooks/detect-justfile.sh
# Expected: Exit 0, warning logged, no skills

# Test: Only private recipes
echo '_private:
    echo "hidden"' > justfile
bash .claude/hooks/detect-justfile.sh
# Expected: Exit 0, info message, no skills

# Test: Skill name conflict
mkdir -p .claude/skills/just-build
echo 'Manual skill' > .claude/skills/just-build/SKILL.md
# (no generated marker)
bash .claude/hooks/detect-justfile.sh
# Expected: Skip just-build, log warning
```

### Test Cases
- ✅ No justfile: Silent exit, no errors
- ✅ Malformed justfile: Error logged, graceful exit
- ✅ `just` not installed: Warning logged, graceful exit
- ✅ No public recipes: Info message, no skills
- ✅ Skill conflict with marker: Overwrite (regenerate)
- ✅ Skill conflict without marker: Skip, warn
- ✅ 100+ recipes: Generate all without issues
- ✅ Empty justfile: Handle gracefully
- ✅ Justfile variants: Support justfile, Justfile, .justfile

### Success Criteria
- All edge cases handled without crashes
- Appropriate logging for each scenario
- Never blocks Claude Code startup
- Comprehensive error handling tests pass

---

## Phase 7: Integration & Documentation

**Goal**: End-to-end testing, documentation, and release preparation

### Deliverables
- [ ] End-to-end integration tests
- [ ] SessionStart hook integration test with Claude Code
- [ ] Complete README.md with examples
- [ ] CONTRIBUTING.md
- [ ] LICENSE
- [ ] .gitignore template for users
- [ ] Example justfile for testing
- [ ] CI/CD setup (GitHub Actions)
- [ ] NPM publish preparation

### Testable Functionality
```bash
# Full workflow test
npm install just-claude
# Claude Code session starts
# Skills appear in Claude Code
# Claude can use skills
# Edit justfile
# Restart Claude Code
# Skills updated

# Test with real justfile projects
git clone <real-project-with-justfile>
cd <project>
npm install just-claude
# Verify skills created correctly
```

### Test Cases
- ✅ Full install → Claude Code session → skills available
- ✅ Skills activate when appropriate
- ✅ Recipe execution via skills works
- ✅ Justfile edits detected on session restart
- ✅ Uninstall removes everything cleanly
- ✅ Works on macOS, Linux, WSL
- ✅ Documentation accurate and complete
- ✅ All examples in README work

### Success Criteria
- End-to-end workflow works seamlessly
- Skills integrate properly with Claude Code
- Documentation is clear and comprehensive
- Package ready for npm publish
- CI/CD pipeline runs all tests
- Real-world testing with actual projects successful

---

## Release Checklist

Before publishing to npm:

- [ ] All tests pass (unit, integration, e2e)
- [ ] Documentation complete and accurate
- [ ] Version number set appropriately (0.1.0 for initial release)
- [ ] LICENSE file included
- [ ] README includes installation, usage, examples
- [ ] package.json keywords and description optimized
- [ ] .npmignore configured properly
- [ ] Test on clean machine/environment
- [ ] Verify no secrets in published package

---

## Post-Release Roadmap (Future Enhancements)

### v0.2.0 - Change Detection
- PostToolUse hook for detecting justfile edits during session
- Auto-regenerate skills when justfile modified

### v0.3.0 - Enhanced Skill Context
- Include recipe dependencies in skill docs
- Show recipe groups if defined
- Better skill descriptions with keywords

### v0.4.0 - Configuration
- `.just-claude.json` for user preferences
- Skill template customization
- Recipe filtering/exclusion rules

### v1.0.0 - Stable Release
- Proven in production use
- Comprehensive test coverage (>80%)
- Performance optimizations
- Community feedback incorporated
